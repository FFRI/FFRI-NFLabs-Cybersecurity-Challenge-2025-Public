FROM ubuntu:24.04

RUN apt update && apt upgrade -y

ARG USER=user
ARG EXE_ARNS=/home/${USER}/arns
ARG FLAG_PATH=/flag.txt

RUN useradd -m ${USER}

COPY ./arns ${EXE_ARNS}
COPY ./flag.txt ${FLAG_PATH}

RUN chmod +x ${EXE_ARNS}

RUN chown -R ${USER}:${USER} /home/${USER} && chmod 700 /home/${USER}
RUN chown ${USER}:${USER} ${FLAG_PATH} && chmod 700 ${FLAG_PATH}

RUN mv /flag.txt /flag-$(head -c 16 /dev/urandom | od -An -tx1 | tr -d ' \n').txt

USER ${USER}
ENV EXE_ARNS=${EXE_ARNS}
CMD ["bash","-c","$EXE_ARNS"]

EXPOSE 8109
