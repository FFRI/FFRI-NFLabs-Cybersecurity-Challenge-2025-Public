FROM alpine:3.19

# Install OpenJDK and other dependencies
RUN apk add --no-cache \
    openjdk17-jre \
    curl \
    bash

ENV SOLR_VULNABLE_VERSION=8.11.0

RUN curl https://archive.apache.org/dist/lucene/solr/${SOLR_VULNABLE_VERSION}/solr-${SOLR_VULNABLE_VERSION}.tgz -O && tar -zxf solr-${SOLR_VULNABLE_VERSION}.tgz 
RUN mv solr-${SOLR_VULNABLE_VERSION} /opt/solr
RUN rm solr-${SOLR_VULNABLE_VERSION}.tgz
RUN chmod -R 755 /opt/solr

COPY ./flag.txt /opt/solr/server/flag.txt

# Expose Solr port
EXPOSE 80

ENV HOME=/opt/solr
RUN adduser -D -h /opt/solr solr && \
    chown -R solr:solr /opt/solr

USER solr

# Start Solr
CMD ["/opt/solr/bin/solr", "start", "-f", "-p", "80", "-a", "-Dcom.sun.jndi.ldap.object.trustURLCodebase=true"]
